package crystallize

import (
	"github.com/genshinsim/gcsim/pkg/core/attributes"
	"github.com/genshinsim/gcsim/pkg/core/player/shield"
)

type Shield struct {
	*shield.Tmpl
	emBonus float64
}

func NewShield(index int, typ attributes.Element, src, lvl int, em float64, expiry int) *Shield {
	s := &Shield{}
	s.Tmpl = &shield.Tmpl{}

	lvl--
	if lvl > 99 {
		lvl = 99
	}
	if lvl < 0 {
		lvl = 0
	}

	s.ActorIndex = index
	s.Target = -1
	s.Ele = typ
	s.ShieldType = shield.Crystallize
	s.Name = "Crystallize " + typ.String()
	s.Src = src
	s.HP = shieldBaseHP[lvl]
	s.Expires = expiry

	s.emBonus = (40.0 / 9.0) * (em / (1400 + em))

	return s
}

func (c *Shield) OnDamage(dmg float64, ele attributes.Element, bonus float64) (float64, bool) {
	bonus += c.emBonus
	return c.Tmpl.OnDamage(dmg, ele, bonus)
}

var shieldBaseHP = []float64{
	91.1791,
	98.707664,
	106.23622,
	113.76477,
	121.29332,
	128.82188,
	136.35042,
	143.87898,
	151.40752,
	158.93608,
	169.99149,
	181.07625,
	192.19037,
	204.0482,
	215.939,
	227.86275,
	247.68594,
	267.5421,
	287.4312,
	303.82642,
	320.22522,
	336.62762,
	352.31927,
	368.01093,
	383.70255,
	394.43237,
	405.18146,
	415.94992,
	426.73764,
	437.5447,
	450.6,
	463.7003,
	476.84558,
	491.1275,
	502.55457,
	514.0121,
	531.4096,
	549.9796,
	568.5849,
	584.9965,
	605.67035,
	626.3862,
	646.0523,
	665.7556,
	685.4961,
	700.8394,
	723.3331,
	745.8653,
	768.4357,
	786.79193,
	809.5388,
	832.32904,
	855.16266,
	878.0396,
	899.4848,
	919.362,
	946.0396,
	974.7642,
	1003.5786,
	1030.077,
	1056.635,
	1085.2463,
	1113.9244,
	1149.2587,
	1178.0648,
	1200.2238,
	1227.6603,
	1257.243,
	1284.9174,
	1314.7529,
	1342.6652,
	1372.7524,
	1396.321,
	1427.3124,
	1458.3745,
	1482.3358,
	1511.9109,
	1541.5493,
	1569.1537,
	1596.8143,
	1622.4197,
	1648.074,
	1666.3761,
	1684.6782,
	1702.9803,
	1726.1047,
	1754.6715,
	1785.8666,
	1817.1375,
	1851.0603,
	1885.0671,
	1921.7493,
	1958.5233,
	2006.1941,
	2041.569,
	2054.4722,
	2065.975,
	2174.7227,
	2186.7683,
	2198.814,
	2205.506,
	2212.198,
	2218.8901,
	2225.582,
	2232.2742,
	2238.9663,
	2245.6582,
	2252.3503,
	2259.0422,
	2265.7344,
	2272.4265,
	2279.1184,
	2285.8105,
	2292.5024,
	2299.1946,
	2305.8867,
	2312.5786,
	2319.2708,
	2325.9626,
	2332.6548,
	2339.347,
	2346.0388,
	2352.731,
	2359.423,
	2366.115,
	2372.8071,
	2379.499,
	2386.1912,
	2392.8833,
	2399.5752,
	2406.2673,
	2412.9592,
	2419.6514,
	2426.3435,
	2433.0354,
	2439.7275,
	2446.4194,
	2453.1116,
	2459.8037,
	2466.4956,
	2473.1877,
	2479.8796,
	2486.5718,
	2493.264,
	2499.9558,
	2506.648,
	2513.3398,
	2520.032,
	2526.724,
	2533.416,
	2540.1082,
	2546.8,
	2553.4922,
	2560.1843,
	2566.8762,
	2573.5684,
	2580.2605,
	2586.9524,
	2593.6445,
	2600.3364,
	2607.0286,
	2613.7207,
	2620.4126,
	2627.1047,
	2633.7966,
	2640.4888,
	2647.181,
	2653.8728,
	2660.565,
	2667.2568,
	2673.949,
	2680.641,
	2687.333,
	2694.0251,
	2700.717,
	2707.4092,
	2714.1013,
	2720.7932,
	2727.4854,
	2734.1772,
	2740.8694,
	2747.5615,
	2754.2534,
	2760.9456,
	2767.6375,
	2774.3296,
	2781.0217,
	2787.7136,
	2794.4058,
	2801.0977,
	2807.7898,
	2814.482,
	2821.1738,
	2827.866,
	2834.558,
	2841.25,
	2847.9421,
	2854.634,
	2861.3262,
	2868.0183,
}
